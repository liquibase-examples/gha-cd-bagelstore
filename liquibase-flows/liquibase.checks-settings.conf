# Liquibase Policy Checks Configuration
# All 12 checks configured with BLOCKER severity (exit code 4)
# Based on postgres-flow-policy-demo pattern

# ===== Check List (comma-separated) =====
liquibase.command.checks.run.checks=ChangeDropColumnWarn,ChangeDropTableWarn,ChangeTruncateTableWarn,ModifyDataTypeWarn,RollbackRequired,SqlGrantAdminWarn,SqlGrantOptionWarn,SqlGrantWarn,SqlRevokeWarn,CheckTablesForIndex,SqlSelectStarWarn,TableColumnLimit

# ===== Destructive Changes =====

# Prevent dropping columns
liquibase.command.checks.customize.ChangeDropColumnWarn.enabled=true
liquibase.command.checks.customize.ChangeDropColumnWarn.severity=4

# Prevent dropping tables
liquibase.command.checks.customize.ChangeDropTableWarn.enabled=true
liquibase.command.checks.customize.ChangeDropTableWarn.severity=4

# Prevent truncating tables
liquibase.command.checks.customize.ChangeTruncateTableWarn.enabled=true
liquibase.command.checks.customize.ChangeTruncateTableWarn.severity=4

# ===== Data Type and Schema Changes =====

# Warn on data type modifications
liquibase.command.checks.customize.ModifyDataTypeWarn.enabled=true
liquibase.command.checks.customize.ModifyDataTypeWarn.severity=4

# ===== Rollback and Recovery =====

# Ensure changesets have rollback capability
liquibase.command.checks.customize.RollbackRequired.enabled=true
liquibase.command.checks.customize.RollbackRequired.severity=4

# ===== Security and Permissions =====

# Detect GRANT statements with ADMIN OPTION
liquibase.command.checks.customize.SqlGrantAdminWarn.enabled=true
liquibase.command.checks.customize.SqlGrantAdminWarn.severity=4

# Detect GRANT statements with GRANT OPTION
liquibase.command.checks.customize.SqlGrantOptionWarn.enabled=true
liquibase.command.checks.customize.SqlGrantOptionWarn.severity=4

# Detect GRANT statements
liquibase.command.checks.customize.SqlGrantWarn.enabled=true
liquibase.command.checks.customize.SqlGrantWarn.severity=4

# Detect REVOKE statements
liquibase.command.checks.customize.SqlRevokeWarn.enabled=true
liquibase.command.checks.customize.SqlRevokeWarn.severity=4

# ===== Performance and Best Practices =====

# Ensure tables have appropriate indexes
liquibase.command.checks.customize.CheckTablesForIndex.enabled=true
liquibase.command.checks.customize.CheckTablesForIndex.severity=4

# Detect SELECT * statements
liquibase.command.checks.customize.SqlSelectStarWarn.enabled=true
liquibase.command.checks.customize.SqlSelectStarWarn.severity=4

# Enforce maximum column count per table (50 columns)
liquibase.command.checks.customize.TableColumnLimit.enabled=true
liquibase.command.checks.customize.TableColumnLimit.severity=4
liquibase.command.checks.customize.TableColumnLimit.maxColumns=50

# ===== Global Check Settings =====

# Check scope: validate both changelog and database
liquibase.command.checks.run.checksScope=changelog,database

# Auto-update check configuration
liquibase.command.checks.run.autoUpdate=on

# Output format for issues
liquibase.command.checks.run.checksOutput=issues

# Enable HTML report generation
liquibase.command.checks.run.checksReportEnabled=true
